<form id="editProductForm" action="/admin/products/edit/<%= product._id %>" method="post" enctype="multipart/form-data" class="forms-sample">
    <!-- Product Information -->
    <div class="form-group">
        <label for="productName">Name</label>
        <input type="text" class="form-control" id="productName" name="name" value="<%= product.Name %>" style="background-color: #333; color: white;" required>
        <p id="name-error" style="color: red; display: none;"></p>
    </div>
    <div class="form-group">
        <label for="productAuthor">Author</label>
        <input type="text" class="form-control" id="productAuthor" name="author" value="<%= product.Author %>" style="background-color: #333; color: white;" required>
        <p id="author-error" style="color: red; display: none;"></p>
    </div>
    <div class="form-group">
        <label for="productDescription">Description</label>
        <textarea class="form-control" id="productDescription" name="description" rows="4" style="background-color: #333; color: white;" required><%= product.Description %></textarea>
        <p id="description-error" style="color: red; display: none;"></p>
    </div>
    <div class="form-group">
        <label for="productCategory">Category</label>
        <select class="form-control" id="productCategory" name="categoryId" style="background-color: #333; color: white;" required>
            <% categories.forEach(function(category) { %>
            <option value="<%= category._id %>" <%= category._id.equals(product.CategoryId) ? 'selected' : '' %>><%= category.CategoryName %></option>
            <% }) %>
        </select>
        <p id="category-error" style="color: red; display: none;"></p>
    </div>
    <div class="form-group">
        <label for="productQuantity">Quantity</label>
        <input type="number" class="form-control" id="productQuantity" name="quantity" value="<%= product.Quantity %>" style="background-color: #333; color: white;" required>
        <p id="quantity-error" style="color: red; display: none;"></p>
    </div>
    <div class="form-group">
        <label for="productPrice">Price</label>
        <input type="number" class="form-control" id="productPrice" name="price" value="<%= product.Price %>" style="background-color: #333; color: white;" required>
        <p id="price-error" style="color: red; display: none;"></p>
    </div>
    
    <!-- Image Upload and Cropping -->
    <div class="form-group">
        <label for="productImages">Images (exactly 3 images required)</label>
        <input type="file" name="img" class="file-upload-default" id="productImages" multiple accept="image/*" style="display: none;">
        <div class="input-group col-xs-12">
            <input type="text" class="form-control file-upload-info" disabled placeholder="Upload Images" style="background-color: #333; color: white;">
            <span class="input-group-append">
                <button class="file-upload-browse btn btn-primary" type="button" id="triggerUpload">Upload</button>
            </span>
        </div>
        <small id="imageError" class="form-text text-danger" style="display: none;">Please select exactly 3 images.</small>
    </div>

    <!-- Display Existing Images -->
    <div id="imagePreviewContainer" class="form-group">
        <label for="existingImages">Existing Images</label>
        <div class="row">
            <% product.Images.forEach(function(image) { %>
            <div class="col-md-4">
                <img src="/static/uploads/<%= image %>" alt="Product Image" class="img-thumbnail" style="max-width: 100%; height: auto;">
            </div>
            <% }) %>
        </div>
    </div>

    <!-- Image Cropping Section -->
    <div id="cropperContainer" style="display: none; width: 400px; height: 400px; margin: 0 auto;">
        <img id="cropperImage" src="" alt="Image for cropping" style="max-width: 100%; max-height: 100%;">
        <div style="margin-top: 10px;">
            <button type="button" id="cropButton" class="btn btn-primary">Crop Image</button>
            <button type="button" id="cancelCropButton" class="btn btn-secondary">Cancel</button>
        </div>
    </div>

    <p id="existingError" style="display:none; align-items: center; text-align: center; color: red;">Product already exists</p>
    <button type="submit" class="btn btn-primary mr-2" onclick="return validateForm()">Save Changes</button>
    <a href="/admin/products" type="button" class="btn btn-dark">Cancel</a>
</form>